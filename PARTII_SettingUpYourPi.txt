#PART II: SETTING UP YOUR PI

############
# GET PI IP  
############
	#To get into your Pi you need to find it's internal ip address
		$ pip install nmag
	#Find your internal (not external) router address
		$ ifconfig
	# In all the output junk you'll see you're internal router address 192.168.1.XXX (mine today is 192.168.1.216)
	# Now look for the raspberry pi (https://braindrivendevelopment.com/2014/12/02/using-nmap-to-find-a-raspberry-pi-within-a-network/)
	# The following command scans between addresses around your computer's ip (192.168.1.0)
	# You will have to plug into an ethernet cable
	$ nmap -sn 192.168.43.47/24
	# One line will have the ip address for your raspberry pi computer
	# Nmap scan report for raspberrypi.fios-router.home (192.168.1.220 or 192.168.1.221 or 192.168.1.134)
	# Boom! You can now get in there
	# After you got the IP, you can enable ssh 

	# As of the November 2016 release, Raspbian has the SSH server disabled by 
	# You'll have to do this with a keyboard and monitor hooked up to your PI, unplug it and set up with a monitor & keyboard
		$ sudo raspi-config
	# Select Advanced Options, SSH, select Yes, Ok, now Finish
	# ssh in to get access to the PI with the username pi and the password raspberry (https://www.raspberrypi.org/documentation/remote-access/ssh/README.md)
		$ reboot

# Now you can connect the pi back to your mac
# You can try pinging your pi to see if the wifi is turned on
	$ ping 192.168.0.220

#############
# SSH into PI 
#############	
#now get ssh in, the default password on the raspberry pi is "raspberry"
	$ ssh pi@192.168.1.221

# say "yes"
	kathryns-Air-2:kathrynthegreat.github.io kathrynvasilaky$ ssh pi@192.168.1.220
	The authenticity of host '192.168.1.220 (192.168.1.220)' can't be established.
	ECDSA key fingerprint is SHA256:cSQ/iFgSbBm/oplRV9lvkYVUCFNXb5gT+fxEhv14/Jc.
	Are you sure you want to continue connecting (yes/no)? yes

#enter your raspberry pi password
	Warning: Permanently added '192.168.1.220' (ECDSA) to the list of known hosts.
	pi@192.168.1.220's password: raspberry

#now you're in. You should see the following at command line
pi@raspberrypi:~ $ 

#############
# Enable Wifi 
#############	
# You need to now store the user/psswd on your pi, so it can pick up the wifi next time without an ethernet
# We're going to edit the wifi protected access conf file: wpa_supplicant.conf (https://www.raspberrypi.org/documentation/configuration/wireless/wireless-cli.md)
# Copy paste your network and password into the file (http://weworkweplay.com/play/automatically-connect-a-raspberry-pi-to-a-wifi-network/)

	pi@raspberrypi:~ $ sudo nano /etc/network/interfaces

		auto wlan0

		allow-hotplug wlan0
		iface wlan0 inet dhcp
		wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf
		iface default inet dhcp

	pi@raspberrypi:~ $ sudo nano /etc/wpa_supplicant/wpa_supplicant.conf


		country=US
		ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
		update_config=1
		network={
		        ssid="FiOS-1I430"
		        psk="hot5229sea524anne"
		}

# Now press Ctrl+X, then Y, then Enter

# At this point, wpa-supplicant will normally notice a change has occurred within a few seconds, and it will try and connect to the # network. If it does not, restart the interface with sudo wpa_cli reconfigure and then reboot.

	pi@raspberrypi:~ $ sudo wpa_cli reconfigure
	pi@raspberrypi:~ $ sudo ifdown wlan0
	pi@raspberrypi:~ $ sudo ifup wlan0
	pi@raspberrypi:~ $ ifconfig wlan0
	pi@raspberrypi:~ $ reboot

# Hit 1 and then your password (default is "raspberry")
# You can verify whether it has successfully connected using ifconfig wlan0. If the inet addr field has an address beside it, the # Raspberry Pi has connected to the network. If not, check that your password and ESSID are correct.


# You're ready to remove the ethernet cable and test it out
# Exit the pi
	pi@raspberrypi:~ $ exit
# Sign back in 
	$ ssh pi@192.168.1.220

########################
# Testing Water Readings
########################

# Getting Adafruit readings. You'll need some package that reads values from your Pi.
# We're using Adafruit MCP3008 Python library (Controlmypi will soon be obsolete) (https://learn.adafruit.com/raspberry-pi-analog-to-digital-converters/mcp3008)

	pi@raspberrypi:~ $ sudo apt-get update
	pi@raspberrypi:~ $ sudo apt-get install build-essential python-dev python-smbus git
	pi@raspberrypi:~ $ cd ~
	pi@raspberrypi:~ $ git clone https://github.com/adafruit/Adafruit_Python_MCP3008.git
	pi@raspberrypi:~ $ cd Adafruit_Python_MCP3008
	pi@raspberrypi:~ $ sudo python setup.py install

# Test the readings out. Dink the sensor in water.
	pi@raspberrypi:~ $ cd /Adafruit_Python_MCP3008/examples
	pi@raspberrypi:~/Adafruit_Python_MCP3008/examples $ nano simpletest.py

# Comment out the software part, keep the Hardware SPI section
# Hardware SPI configuration (taken from pi@raspberrypi:~/Adafruit_Python_MCP3008/examples/simpletest.py)
	SPI_PORT   = 0
	SPI_DEVICE = 1
	mcp = Adafruit_MCP3008.MCP3008(spi=SPI.SpiDev(SPI_PORT, SPI_DEVICE))
	#test the water level out
	mcp.read_adc(5)

# ctrl+o to exit, enter, ctrl+x to exit
	pi@raspberrypi:~/Adafruit_Python_MCP3008/examples $ sudo python simpletest.py 
		Reading MCP3008 values, press Ctrl-C to quit...
		|    0 |    1 |    2 |    3 |    4 |    5 |    6 |    7 |
		---------------------------------------------------------
		|   19 |    9 |    8 |    7 |    6 |  683 |    9 |   18 |
		|   23 |   11 |    9 |    9 |    7 |  684 |   11 |   20 |
		|   25 |   12 |   10 |    9 |    8 |  683 |   12 |   21 |


